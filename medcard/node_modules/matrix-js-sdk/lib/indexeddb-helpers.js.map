{"version":3,"file":"indexeddb-helpers.js","names":["exists","indexedDB","dbName","Promise","resolve","reject","req","open","onupgradeneeded","onblocked","error","onsuccess","db","result","close","deleteDatabase","onerror","ev"],"sources":["../src/indexeddb-helpers.ts"],"sourcesContent":["/*\nCopyright 2019 New Vector Ltd\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * Check if an IndexedDB database exists. The only way to do so is to try opening it, so\n * we do that and then delete it did not exist before.\n *\n * @param {Object} indexedDB The `indexedDB` interface\n * @param {string} dbName The database name to test for\n * @returns {boolean} Whether the database exists\n */\nexport function exists(indexedDB: IDBFactory, dbName: string): Promise<boolean> {\n    return new Promise<boolean>((resolve, reject) => {\n        let exists = true;\n        const req = indexedDB.open(dbName);\n        req.onupgradeneeded = () => {\n            // Since we did not provide an explicit version when opening, this event\n            // should only fire if the DB did not exist before at any version.\n            exists = false;\n        };\n        req.onblocked = () => reject(req.error);\n        req.onsuccess = () => {\n            const db = req.result;\n            db.close();\n            if (!exists) {\n                // The DB did not exist before, but has been created as part of this\n                // existence check. Delete it now to restore previous state. Delete can\n                // actually take a while to complete in some browsers, so don't wait for\n                // it. This won't block future open calls that a store might issue next to\n                // properly set up the DB.\n                indexedDB.deleteDatabase(dbName);\n            }\n            resolve(exists);\n        };\n        req.onerror = ev => reject(req.error);\n    });\n}\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,MAAT,CAAgBC,SAAhB,EAAuCC,MAAvC,EAAyE;EAC5E,OAAO,IAAIC,OAAJ,CAAqB,CAACC,OAAD,EAAUC,MAAV,KAAqB;IAC7C,IAAIL,MAAM,GAAG,IAAb;IACA,MAAMM,GAAG,GAAGL,SAAS,CAACM,IAAV,CAAeL,MAAf,CAAZ;;IACAI,GAAG,CAACE,eAAJ,GAAsB,MAAM;MACxB;MACA;MACAR,MAAM,GAAG,KAAT;IACH,CAJD;;IAKAM,GAAG,CAACG,SAAJ,GAAgB,MAAMJ,MAAM,CAACC,GAAG,CAACI,KAAL,CAA5B;;IACAJ,GAAG,CAACK,SAAJ,GAAgB,MAAM;MAClB,MAAMC,EAAE,GAAGN,GAAG,CAACO,MAAf;MACAD,EAAE,CAACE,KAAH;;MACA,IAAI,CAACd,MAAL,EAAa;QACT;QACA;QACA;QACA;QACA;QACAC,SAAS,CAACc,cAAV,CAAyBb,MAAzB;MACH;;MACDE,OAAO,CAACJ,MAAD,CAAP;IACH,CAZD;;IAaAM,GAAG,CAACU,OAAJ,GAAcC,EAAE,IAAIZ,MAAM,CAACC,GAAG,CAACI,KAAL,CAA1B;EACH,CAvBM,CAAP;AAwBH"}